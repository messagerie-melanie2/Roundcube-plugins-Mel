/**
 * Roundcube functions for default skin interface
 *
 * Copyright (c) 2013, The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original autors in the README file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 */
// Fixed for work with jQuery 3. 

function rcube_mail_ui(){function e(e){if(N||(N=window.localStorage?rcmail.local_storage_get_item("prefs.larry",{}):{}),null==N[e]){var t=rcmail.get_cookie(e);null!=t&&(N[e]=t,window.localStorage&&(rcmail.local_storage_set_item("prefs.larry",N),rcmail.set_cookie(e,t,new Date)))}return N[e]}function t(e,t){if(N[e]=t,window.localStorage)rcmail.local_storage_set_item("prefs.larry",N);else{var i=new Date;i.setYear(i.getFullYear()+1),rcmail.set_cookie(e,t,i)}}function s(e){var t,i,s=e.target;"inner"==s.className&&(s=e.target.parentNode);for(var a in j)if(i=j[a],t=q[a],i.is(":visible")&&s.id!=a+"link"&&s!=i.get(0)&&!t.toggle&&(!t.editable||!v(s,i.get(0)))&&(!t.sticky||!rcube_mouse_is_over(e,i.get(0)))&&!$(s).is(".folder-selector-link")){var o=a+"";window.setTimeout(function(){f(o,!1)},10)}}function a(e){var t=e?10:0;rcmail.resize_timeout&&window.clearTimeout(rcmail.resize_timeout),rcmail.resize_timeout=window.setTimeout(function(){"mail"==rcmail.env.task&&("show"==rcmail.env.action||"preview"==rcmail.env.action?n():"compose"==rcmail.env.action&&d()),$("body.iframe .footerleft").each(function(){var e=$(this),t=$(document.body),i=e.hasClass("floating"),s=t.outerHeight(!0)>$(window).height();if(s!=i){var a=s?"addClass":"removeClass";e[a]("floating"),t[a]("floatingbuttons")}})},t)}function o(e){var t=$(e.object).siblings("div");if(t.length&&$(e.object).insertBefore(t.first()),"error"==e.type&&"login"!=rcmail.env.task){rcmail.hide_message(e.object),A.message_timer&&window.clearTimeout(A.message_timer),A.messagedialog||(A.messagedialog=$("<div>").addClass("popupdialog").hide());var i=e.message,s=function(){A.messagedialog.is(":visible")&&A.messagedialog.dialog("destroy").hide()};A.messagedialog.is(":visible")&&(i=A.messagedialog.html()+"<p>"+e.message+"</p>"),A.messagedialog.html(i).dialog({resizable:!1,closeOnEscape:!0,dialogClass:"popupmessage "+e.type,title:W.errortitle,close:s,position:["center","center"],hide:{effect:"fadeOut"},width:420,minHeight:90}).show(),e.timeout>0&&(A.message_timer=window.setTimeout(s,e.timeout))}}function n(){$("#messagecontent").css("top",$("#messageheader").outerHeight()+1+"px"),$("#message-objects div a").addClass("button"),$("#attachment-list li").length||($("div.rightcol").hide(),$("div.leftcol").css("margin-right","0"))}function l(e){}function r(e){}function c(e){if("TEXTAREA"==e.nodeName){var t=$(e),i=e.scrollHeight,s=e.value.length>80&&i>21?2:1;t.css("height",14*s+"px"),d()}}function d(){var e,t,i,s=$("#composebody"),a=$("#compose-content"),o=$("#composeview-bottom");i=300-(a.height()-o.position().top),a.css("overflow",i>0?"auto":"hidden"),e=s.parent().width()-5,t=s.parent().height()-16,s.width(e).height(t),$("#composebody_tbl").width(e+8+"px").height("").css("margin-top","1px"),$("#composebody_ifr").width(e+8+"px").height(t-40+"px"),$("#googie_edit_layer").height(t+"px")}function p(e){var t=e.total?24*Math.ceil(e.percent/100*20):0;e.total&&480==t&&e.percent<100&&(t-=24),$("#quotadisplay").css("background-position","0 -"+t+"px")}function h(e){if("reply-list"==e.command&&1==rcmail.env.reply_all_mode){var t=rcmail.gettext(e.status?"replylist":"replyall");"preview"==rcmail.env.action?$("a.button.replyall").attr("title",t):$("a.button.reply-all").text(t).attr("title",t)}}function m(e,t){var i=j[e]=$("#"+e);i.appendTo(document.body),i.length&&(q[e]=$.extend(q[e]||{},t||{}))}function u(e,t,i){!i&&q[e]||m(e,i);var s=f(e,t);"function"==typeof(i=q[e]).callback&&i.callback(s)}function f(e,t){var i=j[e],s=q[e],a=$(s.link?s.link:"#"+e+"link");s.above;if(i||(i=j[e]=$("#"+e)).appendTo(document.body),!i||!i.length)return!1;if(void 0===t?t=!i.is(":visible"):s.toggle&&t&&i.is(":visible")&&(t=!1),t&&a.length){var o=$(document).width()-80,n=40;o>300&&(o=300,n=($(document).width()-o)/2),i.css({left:n,top:50,width:o,height:$(document).height()-100})}return i[t?"show":"hide"](),bw.ie6&&s.overlap&&($("select").css("visibility",t?"hidden":"inherit"),$("select",i).css("visibility","inherit")),t}function v(e,t){for(;e.parentNode;){if(e.parentNode==t)return!0;e=e.parentNode}return!1}function g(t){var i,s=$(t.target),a=$("#mailpreviewframe"),o=!a.is(":visible");S.pos||parseInt(e("mailviewsplitter")||320);a.toggle(),s.removeClass().addClass(o?"enabled":"closed"),o?($("#mailview-top").removeClass("fullheight").css({bottom:"auto"}),$("#mailview-bottom").css({height:"auto"}).show(),rcmail.env.contentframe="messagecontframe",(i=rcmail.message_list.get_single_selection())&&rcmail.show_message(i,!1,!0),S.handle?(S.handle.show(),S.resize()):S.init()):(rcmail.env.contentframe=null,rcmail.show_contentframe(!1),$("#mailview-top").addClass("fullheight").css({height:"auto",bottom:"0px"}),$("#mailview-bottom").css({top:"auto",height:"0px"}).hide(),S.handle&&S.handle.hide()),rcmail.message_list&&(o&&i&&rcmail.message_list.scrollto(i),rcmail.message_list.resize()),rcmail.command("save-pref",{name:"preview_pane",value:o?1:0})}function w(){$("#preview-shortheaders").toggle();var e=$("#preview-allheaders").toggle(),i=$("a#previewheaderstoggle");e.is(":visible")?i.attr("href","#hide").removeClass("add").addClass("remove"):i.attr("href","#details").removeClass("remove").addClass("add"),t("previewheaders",e.is(":visible")?"1":"0")}function b(e){rcmail.env.threading!=("thread"==e)&&rcmail.set_list_options(null,void 0,void 0,"thread"==e?1:0),$("#maillistmode, #mailthreadmode").removeClass("selected"),$("#mail"+e+"mode").addClass("selected")}function _(e){e&&e.props&&"attachmentmenu"==e.props.menu?f("attachmentmenu"):y()}function k(e){z()}function x(e){var t=e.parentNode.id.replace(/^attach/,"");$("#attachmenuopen").unbind("click").attr("onclick","").click(function(e){return rcmail.command("open-attachment",t,this)}),$("#attachmenudownload").unbind("click").attr("onclick","").click(function(){rcmail.command("download-attachment",t,this)}),q.attachmentmenu.link=e,rcmail.command("menu-open",{menu:"attachmentmenu",id:t})}function y(){var e=$("#listoptions");e.is(":visible")?e.dialog("close"):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.coltypes))}),e.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,close:function(){e.dialog("destroy").hide()},minWidth:500,width:e.width()+25}).show())}function z(){$("#listoptions").dialog("close");var e=$('input[name="sort_col"]:checked').val(),t=$('input[name="sort_ord"]:checked').val(),i=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(i,e,t,rcmail.env.threading)}function C(e){var t=$("#contacts-table"),i=t.parent().css("overflow","hidden");t.clone().css({position:"absolute",top:"0",left:"0",width:t.width()+"px","z-index":10}).appendTo(i).animate({left:-(t.width()+5)+"px"},300,"swing",function(){$(this).remove(),i.css("overflow","auto")})}function T(e){var t=$("#contacts-table"),i=t.parent().css("overflow","hidden"),s=t.clone().appendTo(i);t.css({position:"absolute",top:"0",left:-(t.width()+5)+"px",width:t.width()+"px",height:t.height()+"px","z-index":10}).animate({left:"0"},300,"linear",function(){s.remove(),$(this).css({position:"relative",left:"0",width:"100%",height:"auto","z-index":1}),i.css("overflow","auto")})}function E(){var e=$("#upload-dialog");e.is(":visible")?e.dialog("close"):("compose"!=rcmail.env.action||e.data("extended")||($("<a>").addClass("iconlink add").attr("href","#add").html("Add").appendTo($('input[type="file"]',e).parent()).click(L),e.data("extended",!0)),e.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:e.attr("title"),close:function(){try{$("#upload-dialog form").get(0).reset()}catch(e){}e.dialog("destroy").hide(),$("div.addline",e).remove()},width:480}).show(),document.all||$("input[type=file]",e).first().click())}function L(e){var t=$(this).parent(),i=t.clone().addClass("addline").insertAfter(t);i.children(".iconlink").click(L),i.children("input").val(""),document.all||$("input[type=file]",i).click()}function I(e,t){var i=$("#compose-"+e);if(!i.is(":visible"))return D[e]&&!t&&$("#_"+e).val(D[e]),i.show(),$("#"+e+"-link").hide(),d(),!1}function H(e,t){var i=$(e),s=i.get(0).id,a=i.children("fieldset");if(a.length){s||(s="rcmtabcontainer",i.attr("id",s)),t=t||0,a.each(function(e){e!=t&&$(this).hide()});var o=$("<div>").addClass("tabsbar").prependTo(i);a.each(function(e){var i,a,n=$(this),l=n.children("legend");a=$("<a>").text(l.text()).attr("href","#"),i=$("<span>").attr({id:"tab"+e,class:"tablink"}).click(function(){return M(s,e),!1}),l.remove(),n.addClass("tab"),e==t&&i.addClass("selected"),i.append(a).appendTo(o)})}}function M(e,t){$("#"+e).children("fieldset").each(function(e){$(this)[t==e?"show":"hide"](),$("#tab"+e).toggleClass("selected",e==t)}),a()}var S,N,W={},j={},q={forwardmenu:{editable:1},searchmenu:{editable:1,callback:function(e){if(e&&rcmail.env.search_mods){var t,i,s=j.searchmenu,a=$('input:checkbox[name="s_mods[]"]',s),o=rcmail.env.mailbox,n=rcmail.env.search_mods;if("mail"==rcmail.env.task?(n=n[o]?n[o]:n["*"],i="text"):i="*",n[i])a.map(function(){this.checked=!0,this.disabled=this.value!=i});else{a.prop("disabled",!1).prop("checked",!1);for(t in n)$("#s_mod_"+t).prop("checked",!0)}}}},attachmentmenu:{},listoptions:{editable:1},dragmenu:{sticky:1},groupmenu:{above:1},mailboxmenu:{above:1},spellmenu:{callback:function(e){var t,s=rcmail.spellcheck_lang(),a=j.spellmenu,o=$("ul",a);if(!o.length){o=$('<ul class="toolbarmenu selectable">');for(i in rcmail.env.spell_langs)t=$("<li>"),$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))}).appendTo(t),t.appendTo(o);o.appendTo(a)}$("li",o).each(function(){var e=$("a",this);e.data("lang")==s?e.addClass("selected"):e.hasClass("selected")&&e.removeClass("selected")})}},"attachment-form":{editable:1,above:1,toggle:!bw.ie&&!bw.linux},"upload-form":{editable:1,toggle:!bw.ie&&!bw.linux}},A=this,D={};if(this.set=function(e,t){W[e]=t},this.init=function(){if(rcmail.addEventListener("message",o),$("#taskbar a").each(function(e,t){$(t).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")}),$("#taskbar .minmodetoggle").click(function(e){t("minimalmode",$(document.body).toggleClass("minimal").hasClass("minimal")?1:0),$(window).resize()}),"mail"==rcmail.env.task){if(rcmail.addEventListener("menu-open",_).addEventListener("menu-save",k).addEventListener("responseafterlist",function(e){b(rcmail.env.threading?"thread":"list")}),(L=$("#dragmessagemenu")).length&&(rcmail.gui_object("dragmenu","dragmessagemenu"),j.dragmenu=L),"show"==rcmail.env.action||"preview"==rcmail.env.action)rcmail.addEventListener("enable-command",h).addEventListener("aftershow-headers",function(){n()}).addEventListener("afterhide-headers",function(){n()}),$("#previewheaderstoggle").click(function(e){return w(),!1}),$("#attachment-list > li").each(function(){$(this).append($('<a class="drop"></a>').click(function(){x(this)}))}),"1"==e("previewheaders")&&w();else if("compose"==rcmail.env.action){rcmail.addEventListener("aftersend-attachment",E).addEventListener("add-recipient",function(e){I(e.field,!0)}).addEventListener("aftertoggle-editor",function(e){window.setTimeout(function(){d()},200),e&&e.mode&&$("select[name='editorSelector']").val(e.mode)});var i,m,f,v=["cc","bcc","replyto","followupto"];for(i=0;i<v.length;i++)m=v[i],(f=$("#_"+m)).length&&(f.on("change",{v:m},function(e){this.value&&I(e.data.v,!0)}),""!=f.val()&&I(m,!0));$("#composeoptionstoggle").click(function(){return $("#composeoptionstoggle").toggleClass("remove"),$("#composeoptions").toggle(),d(),t("composeoptions",$("#composeoptions").is(":visible")?"1":"0"),!1}).css("cursor","pointer"),"0"!==e("composeoptions")&&$("#composeoptionstoggle").click(),$("textarea[name='_to'], textarea[name='_cc'], textarea[name='_bcc']").change(function(e){c(this)}).change(),rcmail.addEventListener("autocomplete_insert",function(e){c(e.field)});var y=rcmail.opener();y&&"compose"==y.env.action&&$("#composeoptionstoggle",opener.document).hasClass("remove")&&$("#composeoptionstoggle").click(),new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:!0,start:248,min:170,size:12,render:d}).init()}else if("list"!=rcmail.env.action&&rcmail.env.action)"get"==rcmail.env.action&&new rcube_splitter({id:"mailpartsplitterv",p1:"#messagepartheader",p2:"#messagepartcontainer",orientation:"v",relative:!0,start:226,min:150,size:12}).init();else{var z=$("#mailpreviewframe").is(":visible");$("#mailpreviewtoggle").addClass(z?"enabled":"closed").click(function(e){return g(e),!1}),$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(e){return b("list"),!1}),$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(e){return b("thread"),!1}),S=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:!0,start:310,min:150,size:12,offset:4}),z&&S.init(),rcmail.addEventListener("setquota",p).addEventListener("enable-command",h).addEventListener("afterimport-messages",E)}$("#mailview-left").length&&new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",relative:!0,start:226,min:150,size:12,callback:l,render:r}).init()}else if("settings"==rcmail.env.task)rcmail.addEventListener("init",function(){var e="#settingstabpreferences";rcmail.env.action&&(e="#settingstab"+(rcmail.env.action.indexOf("identity")>0?"identities":rcmail.env.action.replace(/\./g,""))),$(e).addClass("selected").children().first().removeAttr("onclick").click(function(){return!1})}),"folders"==rcmail.env.action?(new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init(),new rcube_scroller("#folderslist-content","#folderslist-header","#folderslist-footer"),rcmail.addEventListener("setquota",p)):"identities"==rcmail.env.action?new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init():"responses"==rcmail.env.action?new rcube_splitter({id:"responseviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init():"preferences"!=rcmail.env.action&&rcmail.env.action?"edit-prefs"==rcmail.env.action&&($('<a href="#toggle">&#9660;</a>').addClass("advanced-toggle").appendTo("#preferences-details fieldset.advanced legend"),$("#preferences-details fieldset.advanced legend").click(function(e){var t=$(this).hasClass("collapsed");$(".advanced-toggle",this).html(t?"&#9650;":"&#9660;"),$(this).toggleClass("collapsed").closest("fieldset").children(".propform").toggle()}).addClass("collapsed")):new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:!0,start:266,min:180,size:12}).init();else if("addressbook"==rcmail.env.task){rcmail.addEventListener("afterupload-photo",E).addEventListener("beforepushgroup",C).addEventListener("beforepopgroup",T),""==rcmail.env.action&&(new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:!0,start:226,min:150,size:12,render:r}).init(),new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:!0,start:286,min:270,size:12}).init());var L=$("#dragcontactmenu");L.length&&(rcmail.gui_object("dragmenu","dragcontactmenu"),j.dragmenu=L)}$(".tabbed").each(function(e,t){H(t)});var M=$("body > div.minwidth");M.length&&M.css("min-width",$(".toolbar").width()+$("#quicksearchbar").width()+$("#searchfilter").width()+30),$(document.body).bind("mouseup",s).bind("keyup",function(e){if(27==e.keyCode)for(var t in j)j[t].is(":visible")&&u(t,!1)}),$("iframe").on("load",function(e){try{var t=this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null;$(t).mouseup(s)}catch(e){}}).contents().mouseup(s),window.onresize=a,a()},this.init_tabs=H,this.show_about=function(e){var t=$("<iframe>").attr("id","aboutframe").attr("src",rcmail.url("settings/about")).attr("frameborder","0").appendTo(document.body),i=Math.floor(.75*$(window).height()),s={},a=$("#supportlink");a.length&&(W.supporturl=a.attr("href"))&&(s[a.html()]=function(e){W.supporturl.indexOf("mailto:")<0?window.open(W.supporturl):location.href=W.supporturl}),t.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:e?e.title||e.innerHTML:null,close:function(){t.dialog("destroy").remove()},buttons:s,width:640,height:i}).width(640)},this.show_popup=u,this.add_popup=m,this.set_searchmod=function(e){var t,i,s=rcmail.env.task,a=rcmail.env.search_mods,o=rcmail.env.mailbox;a||(a={}),"mail"==s?(a[o]||(a[o]=rcube_clone_object(a["*"])),i=a[o],t="text"):(i=a,t="*"),e.checked?i[e.value]=1:delete i[e.value],e.value==t&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=e&&(this.checked=!0,e.checked?(this.disabled=!0,delete i[this.value]):(this.disabled=!1,i[this.value]=1))})},this.show_uploadform=E,this.show_header_row=I,this.hide_header_row=function(e){var t=$("#_"+e);return D[e]=t.val(),t.val(""),$("#compose-"+e).hide(),$("#"+e+"-link").show(),d(),!1},this.update_quota=p,this.get_pref=e,this.save_pref=t,window.$&&document.body){var O=e("minimalmode");(parseInt(O)||null===O&&$(window).height()<850)&&$(document.body).addClass("minimal"),bw.tablet&&$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}function rcube_scroller(e,t,i){var s=this;this.list=$(e),this.top=$(t),this.bottom=$(i),this.step_size=6,this.step_time=20,this.delay=500,this.top.mouseenter(function(){rcmail.drag_active&&(s.ts=window.setTimeout(function(){s.scroll("down")},s.delay))}).mouseout(function(){s.ts&&window.clearTimeout(s.ts)}),this.bottom.mouseenter(function(){rcmail.drag_active&&(s.ts=window.setTimeout(function(){s.scroll("up")},s.delay))}).mouseout(function(){s.ts&&window.clearTimeout(s.ts)}),this.scroll=function(e){var t=this,i=this.step_size;rcmail.drag_active&&("down"==e&&(i*=-1),this.list.get(0).scrollTop+=i,this.ts=window.setTimeout(function(){t.scroll(e)},this.step_time))}}function rcube_splitter(e){function t(e){(bw.konq||bw.chrome||bw.safari)&&(document.body.style.webkitUserSelect="none"),n.p1pos=n.relative?n.p1.position():n.p1.offset(),n.p2pos=n.relative?n.p2.position():n.p2.offset(),n.drag_active=!0,$(document).bind("mousemove."+this.id,i).bind("mouseup."+this.id,a),$("iframe").each(function(e,t){$("<div>").attr("id","iframe-splitter-fix-"+e).addClass("iframe-splitter-fix").css({background:"#fff",width:t.offsetWidth+"px",height:t.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")})}function i(e){return!!n.drag_active&&(window.clearTimeout(n.ts),n.ts=window.setTimeout(function(){s(e)},1),!1)}function s(e){var t=rcube_event.get_mouse_pos(e);if(n.relative){var i=n.p1.parent().offset();t.x-=i.left,t.y-=i.top}n.horizontal?t.y-n.halfsize>n.p1pos.top&&t.y+n.halfsize<n.p2pos.top+n.p2.outerHeight()&&(n.pos=Math.max(n.min,t.y-n.offset),n.resize()):t.x-n.halfsize>n.p1pos.left&&t.x+n.halfsize<n.p2pos.left+n.p2.outerWidth()&&(n.pos=Math.max(n.min,t.x-n.offset),n.resize()),n.p1pos=n.relative?n.p1.position():n.p1.offset(),n.p2pos=n.relative?n.p2.position():n.p2.offset()}function a(e){return(bw.konq||bw.chrome||bw.safari)&&(document.body.style.webkitUserSelect="auto"),$(document).unbind("."+n.id),n.drag_active=!1,$("div.iframe-splitter-fix").remove(),n.set_cookie(),"function"==typeof n.callback&&n.callback(n),!!bw.safari||rcube_event.cancel(e)}function o(e){if(n.horizontal){var t=parseInt(n.p2.parent().outerHeight(),10)-parseInt(n.p2[0].style.top,10)-(bw.ie8?2:0);n.p2.css("height",(t>0?t:0)+"px")}else{var i=parseInt(n.p2.parent().outerWidth(),10)-parseInt(n.p2[0].style.left,10);n.p2.css("width",(i>0?i:0)+"px")}}this.p=e,this.id=e.id,this.horizontal="horizontal"==e.orientation||"h"==e.orientation,this.halfsize=(void 0!==e.size?e.size:10)/2,this.pos=e.start||0,this.min=e.min||20,this.offset=e.offset||0,this.relative=!!e.relative,this.drag_active=!1,this.render=e.render,this.callback=e.callback;var n=this;rcube_splitter._instances[this.id]=n,this.init=function(){if(this.p1=$(this.p.p1),this.p2=$(this.p.p2),this.p1.length&&this.p2.length){if(this.p1pos=this.relative?this.p1.position():this.p1.offset(),this.p2pos=this.relative?this.p2.position():this.p2.offset(),this.handle=$("<div>").attr("id",this.id).attr("unselectable","on").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.p1.parent()).bind("mousedown",t),this.horizontal){var e=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:e+"px"})}else{var i=this.p1pos.left+this.p1.outerWidth();this.handle.css({left:i+"px",top:"0px"})}bw.ie&&$(window).resize(o);var s=this.get_cookie();s&&!isNaN(s)?(this.pos=parseFloat(s),this.resize()):this.pos&&(this.resize(),this.set_cookie())}},this.resize=function(){if(this.horizontal){if(this.p1.css("height",Math.floor(this.pos-this.p1pos.top-this.halfsize)+"px"),this.p2.css("top",Math.ceil(this.pos+this.halfsize+2)+"px"),this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px"),bw.ie){var e=parseInt(this.p2.parent().outerHeight(),10)-parseInt(this.p2.css("top"),10)-(bw.ie8?2:0);this.p2.css("height",(e>0?e:0)+"px")}}else if(this.p1.css("width",Math.floor(this.pos-this.p1pos.left-this.halfsize)+"px"),this.p2.css("left",Math.ceil(this.pos+this.halfsize)+"px"),this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset+3)+"px"),bw.ie){var t=parseInt(this.p2.parent().outerWidth(),10)-parseInt(this.p2.css("left"),10);this.p2.css("width",(t>0?t:0)+"px")}this.p2.resize(),this.p1.resize(),this.drag_active&&$("iframe").each(function(e,t){var i=$(this).offset();$("#iframe-splitter-fix-"+e).css({top:i.top+"px",left:i.left+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})}),"function"==typeof this.render&&this.render(this)},this.get_cookie=function(){return window.UI?UI.get_pref(this.id):null},this.set_cookie=function(){window.UI&&UI.save_pref(this.id,this.pos)}}rcube_splitter._instances={},rcube_splitter.get_instance=function(e){return rcube_splitter._instances[e]};