"addressbook"==rcmail.env.task&&$(document).on("keyup","input#quicksearchbox",function(e){if("plugin.annuaire"==rcmail.env.action)var a=$("#annuaire-list li.object");else var a=$("#contacts-table tr.contact");var l=$(this).val().toLowerCase();a.show(),a.each(function(){if("plugin.annuaire"==rcmail.env.action)var e=$(this).find("> span.name");else var e=$(this).find("> td.name");var a=e.text().replace(/(<([^>]+)>)/gi,"");l.length>2&&a.toLowerCase().indexOf(l)>=0?e.html(a.replace(new RegExp(l,"gi"),"<strong>$&</strong>")):e.html(a)})}),$(document).on("keyup","input#contactsearchbox",function(e){$("#annuaire-list li.object").show();var a=$(this).val().toLowerCase();$("#annuaire-list li.object").each(function(){var e=$(this).find("> span.name");a.length>1&&e.text().toLowerCase().indexOf(a)>=0?(e.html(e.text()),e.html(e.text().replace(new RegExp(a,"gi"),"<strong>$&</strong>"))):e.html(e.text())})}),window.rcmail&&rcmail.addEventListener("init",function(e){if("addressbook"==rcmail.env.task&&($("#directorylist-header").text(rcmail.get_label("mel_larry.allannuaires")),$('<li class="legend"><span>'+rcmail.get_label("mel_larry.personalannuaire")+"</span></li>").insertAfter("#directorylist li.all"),$("#savedsearchlist > li").length&&$("#savedsearchlist").prepend('<li class="legend"><span>'+rcmail.get_label("mel_larry.personalsearchs")+"</span></li>"),rcmail.addEventListener("abook_search_insert",function(e){$("#savedsearchlist > li.legend").length||$("#savedsearchlist").prepend('<li class="legend"><span>'+rcmail.get_label("mel_larry.personalsearchs")+"</span></li>")})),"addressbook"==rcmail.env.task&&"plugin.annuaire"==rcmail.env.action)$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in")+" "+$("#directorylist li.addressbook.selected > a").text());else if("calendar"==rcmail.env.task)$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in_calendars"));else if("tasks"==rcmail.env.task)$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in_tasks"));else if("settings"!=rcmail.env.task||rcmail.env.courrielleur){if("mail"==rcmail.env.task)if(""==rcmail.env.action||"show"==rcmail.env.action){var a={calendar:"#messagetoolbar > a.calendarlink",bounce:"#messagetoolbar > a.bounce",mel_labels_sync:"#messagetoolbar > a.thunderbird",managesieve:"#messagetoolbar > a.filterlink"};for(var l in a)-1!==rcmail.env.plugins.indexOf(l)&&$(a[l]).css("display","inline-block");""==rcmail.env.action&&-1!==rcmail.env.plugins.indexOf("mel_archivage")&&$("#messagetoolbar > a.archiver").css("display","inline-block"),-1!==rcmail.env.plugins.indexOf("mel_junk")?$("#messagetoolbar > span.junk").css("display","inline-block"):-1!==rcmail.env.plugins.indexOf("markasjunk")&&$("#messagetoolbar > a.junk").css("display","inline-block"),"show"==rcmail.env.action&&("light"==localStorage.getItem("message.theme")&&($("#messagecontent .switch.theme input").prop("checked",!0),$("#mainscreen").addClass("light")),$("#messagecontent .switch.theme input").change(function(){$("#mainscreen").toggleClass("light"),localStorage.setItem("message.theme",this.checked?"light":"dark")}))}else"preview"==rcmail.env.action?(-1!==rcmail.env.plugins.indexOf("calendar")&&$("#countcontrols > a.calendarlink").css("display","inline-block"),"light"==localStorage.getItem("message.theme")&&($("#messagepreview .switch.theme input").prop("checked",!0),$("body.iframe").addClass("light")),$("#messagepreview .switch.theme input").change(function(){$("body.iframe").toggleClass("light"),localStorage.setItem("message.theme",this.checked?"light":"dark")})):"compose"==rcmail.env.action&&$(rcmail.gui_objects.filedrop).get(0).addEventListener("drop",function(e){$("#compose-attachments").removeClass("hide")},!1)}else{var t=$("<div>");t.attr("class","disconnect");var s=$("<a>");s.attr("href","./?_task=logout"),s.attr("onclick","return rcmail.command('switch-task','logout',this,event)"),s.text(rcmail.get_label("mel.logout")),t.append(s),$("#settings-sections").append(t)}}),rcmail.addEventListener("actionafter",function(e){if("set-listmode"==e.action&&("threads"==e.props?$("#messagelist").addClass("threaded"):$("#messagelist").removeClass("threaded")),"list"==e.action)if("mail"==rcmail.env.task)$("#searchmenu-menu #s_scope_all").is(":checked")?$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in_all_folders")):$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in")+" "+$("#folderlist-content #mailboxlist li.mailbox.selected > a").clone().children().remove().end().text()),rcmail.env.threading?$("#messagelist").addClass("threaded"):$("#messagelist").removeClass("threaded");else if("addressbook"==rcmail.env.task){rcmail.set_searchscope("list");var a=$("#directorylist li.addressbook.selected > a").clone().children().remove().end().text();$("#quicksearchbox").attr("placeholder",rcmail.get_label("mel_larry.search_in")+" "+a)}}),rcmail.addEventListener("responseaftersearch",function(e){if("addressbook"==rcmail.env.task&&(""==e.response.env.source||!e.response.env.source)){var a=new Object;$("#contacts-table tr").each(function(){var e=$(this).attr("id").split(/-(.+)/)[1];e&&!a[e]&&(a[e]=$(this).attr("id"))});var l=!0;for(var t in a){var s=rcmail.get_label("mel_larry.foundin")+" "+$("#directorylist li#rcmli"+rcmail.html_identifier_encode(t)+" > a").clone().children().remove().end().text();l||$('<tr class="space"><td>&nbsp;</td></tr>').insertBefore("tr#"+a[t]),$('<tr class="legend"><td>'+s+"</td></tr>").insertBefore("tr#"+a[t]),l=!1}}});