var saving_lock;$(document).on("focusin","#quickaddinput",function(){$("#taskstoolbar").hide(),$("#quickaddbox").addClass("focus")}),$(document).on("focusout","#quickaddinput",function(){setTimeout(()=>{$("#taskstoolbar").show(),$("#quickaddbox").removeClass("focus")},500)}),$(document).on("click","#taskcreateform .form-section.submit input",function(){if(!rcmail.busy){var a=$("#taskcreateform #taskcreate-title").val(),b={tempid:Date.now(),title:a,readonly:!1,mask:0,complete:0,list:rctasks.selected_list};if(a&&a.length){var c=$("#taskcreateform #taskcreate-date").val(),d=$("#taskcreateform #taskcreate-time").val(),e=$("input#create-alarm-item").is(":checked"),f=$("input#create-priority-item").is(":checked");c.length?(b.date=c,b.time=d.length?d:null):d.length?(b.date=get_today_date(),b.time=d.length?d:null):(b.date=null,b.time=null),b.flagged=f?1:0,b.valarms=e?[{trigger:"-PT1M",action:"DISPLAY"}]:null,saving_lock=rcmail.set_busy(!0,"tasklist.savingdata"),rcmail.http_post("tasks/task",{action:"new",t:b,filter:0}),$("button.ui-button:ui-button").button("option","disabled",rcmail.busy)}setTimeout(()=>{rcmail.command("menu-close","taskcreatepopup")},500)}}),$(document).on("keypress","#taskcreateform input#taskcreate-title",function(a){if(13==a.which)return $("#taskcreateform .form-section.submit input").click(),!1}),window.rcmail&&(rcmail.addEventListener("init",function(){rcmail.addEventListener("plugin.unlock_saving",function(){saving_lock&&(rcmail.set_busy(!1,null,saving_lock),$("button.ui-button:ui-button").button("option","disabled",!1),saving_lock=null)})}),rcmail.addEventListener("menu-open",function(a){if("taskcreatepopup"==a.name){var b={dateFormat:rctasks.settings.date_format.replace(/M/g,"m").replace(/mmmmm/,"MM").replace(/mmm/,"M").replace(/dddd/,"DD").replace(/ddd/,"D").replace(/yy/g,"y"),firstDay:rctasks.settings.first_day,changeMonth:!1,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(a){$("#taskcreate-date").val(a)}};$("#taskcreate-datepicker").datepicker(b),rctasks.init_time_autocomplete($("#taskcreate-time"),{container:"#taskcreateform"}),$("#taskcreateform #taskcreate-title").focus()}}),rcmail.addEventListener("menu-close",function(a){"taskcreatepopup"==a.name&&($("#taskcreateform #taskcreate-title").val(""),$("#taskcreateform #taskcreate-date").val(""),$("#taskcreateform #taskcreate-time").val(""),$("input#create-alarm-item").prop("checked",!1),$("input#create-priority-item").prop("checked",!1),$("#taskcreate-datepicker").datepicker("setDate"))}));function get_today_date(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),b+"/"+c+"/"+d}